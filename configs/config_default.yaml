# ==============================================================================
# PixEagle Configuration File - v2.0
# ==============================================================================
# üìã Priority parameters are at the top for quick access
# üîß All legacy parameters preserved (deprecated ones marked in comments)
# üìò Enhanced documentation for each parameter
# ==============================================================================




# ==============================================================================
# PRIMARY VIDEO INPUT CONFIGURATION (Top Priority)
# ==============================================================================
VideoSource:
  # Primary video source selection
  # Options: VIDEO_FILE, USB_CAMERA, RTSP_OPENCV, RTSP_STREAM, UDP_STREAM, HTTP_STREAM, CSI_CAMERA, CUSTOM_GSTREAMER
  VIDEO_SOURCE_TYPE: USB_CAMERA
  
  # === Universal Capture Parameters (Applied to ALL sources) ===
  # üîß These ensure consistent processing regardless of input type
  CAPTURE_WIDTH: 640          # Width in pixels (lower = less CPU)
  CAPTURE_HEIGHT: 480         # Height in pixels 
  CAPTURE_FPS: 30            # Target FPS (actual may vary by source)
  DEFAULT_FPS: 30            # Fallback if source doesn't report FPS
  
  # === Performance Optimization ===
  # üöÄ Enable for Raspberry Pi, Jetson, or low-power systems
  USE_GSTREAMER: false       # true = Use GStreamer pipelines (better for embedded)
  
  # === Source-Specific Parameters ===
  # Video file source
  VIDEO_FILE_PATH: resources/test4.mp4
  
  # USB Camera (webcam)
  CAMERA_INDEX: 0            # 0=first camera, 1=second, etc.
  
  # Network streams
  RTSP_URL: rtsp://192.168.0.108:554/stream=0
  RTSP_LATENCY: 0           # Buffer in ms (0=minimum latency, 200=stable)
  UDP_URL: udp://172.21.144.1:5000
  HTTP_URL: http://172.21.144.1:8100
  
  # CSI Camera (Raspberry Pi/Jetson camera)
  CSI_SENSOR_ID: 0          # Usually 0 for first CSI port
  
  # Custom GStreamer pipeline (advanced users)
  # Example: "videotestsrc ! video/x-raw,width=640,height=480 ! videoconvert ! appsink"
  CUSTOM_PIPELINE: ""
  
  # === Legacy Parameters (kept for compatibility) ===
  # DEPRECATED: Use CAPTURE_WIDTH/HEIGHT instead of CSI_WIDTH/HEIGHT
  STORE_LAST_FRAMES: 5      # Frame history buffer size

# ==============================================================================
# USB CAMERA OPTIMIZATION
# ==============================================================================
USBCamera:
  # Device path for Linux GStreamer (ignored on Windows)
  DEVICE_PATH: /dev/video0
  
  # Pixel format selection (impacts CPU usage)
  # YUYV = uncompressed (moderate CPU)
  # MJPG = compressed (lowest CPU, recommended for RPi)
  PIXEL_FORMAT: YUYV
  
  # OpenCV backend optimizations (when USE_GSTREAMER=false)
  USE_V4L2_BACKEND: false    # Linux only: direct V4L2 access
  OPENCV_BUFFER_SIZE: 1      # 1=lowest latency, 3=smoother
  OPENCV_FOURCC: ""          # Force codec: "MJPG", "H264", etc.

# ==============================================================================
# CSI CAMERA CONFIGURATION (Raspberry Pi/Jetson)
# ==============================================================================
Camera:  # Legacy name kept for compatibility
  # CSI-specific settings
  CSI_WIDTH: 640            # DEPRECATED: Use CAPTURE_WIDTH in VideoSource
  CSI_HEIGHT: 480           # DEPRECATED: Use CAPTURE_HEIGHT in VideoSource
  CSI_FRAMERATE: 30         # DEPRECATED: Use CAPTURE_FPS in VideoSource
  CSI_FLIP_METHOD: 0        # 0=none, 1=90¬∞CW, 2=180¬∞, 3=90¬∞CCW, 4=horizontal, 5=vertical

CSICamera:  # New section name (preferred)
  SENSOR_ID: 0              # Camera sensor ID
  FLIP_METHOD: 0            # Image rotation/flip

# ==============================================================================
# NETWORK CONFIGURATION (Connection Settings)
# ==============================================================================
PX4:
  # üöÅ PX4 Autopilot connection via MAVSDK
  EXTERNAL_MAVSDK_SERVER: true
  # For SITL: udp://127.0.0.1:14540
  # For companion computer: udp://127.0.0.1:14540  
  # For WSL: udp://172.21.148.30:14540 (use your WSL IP)
  SYSTEM_ADDRESS: udp://127.0.0.1:14540

MAVLink:
  # üì° MAVLink telemetry data source (MAVLink2REST)
  MAVLINK_ENABLED: true
  # For local: 127.0.0.1
  # For WSL: 172.21.148.30 (your WSL IP)
  MAVLINK_HOST: 127.0.0.1
  MAVLINK_PORT: 8088
  MAVLINK_POLLING_INTERVAL: 0.5    # Data refresh rate in seconds
  
  # Data points to fetch from MAVLink2REST API
  MAVLINK_DATA_POINTS:
    latitude: /vehicles/1/components/1/messages/GLOBAL_POSITION_INT/message/lat
    longitude: /vehicles/1/components/1/messages/GLOBAL_POSITION_INT/message/lon
    altitude_msl: /vehicles/1/components/1/messages/ALTITUDE/message/altitude_amsl
    altitude_agl: /vehicles/1/components/1/messages/ALTITUDE/message/altitude_relative
    voltage: /vehicles/1/components/1/messages/SYS_STATUS/message/voltage_battery
    airspeed: /vehicles/1/components/1/messages/VFR_HUD/message/airspeed
    throttle: /vehicles/1/components/1/messages/VFR_HUD/message/throttle
    groundspeed: /vehicles/1/components/1/messages/VFR_HUD/message/groundspeed
    climb: /vehicles/1/components/1/messages/VFR_HUD/message/climb
    vn: /vehicles/1/components/1/messages/LOCAL_POSITION_NED/message/vx
    ve: /vehicles/1/components/1/messages/LOCAL_POSITION_NED/message/vy
    vd: /vehicles/1/components/1/messages/LOCAL_POSITION_NED/message/vz
    flight_path_angle: null
    roll: /vehicles/1/components/1/messages/ATTITUDE/message/roll
    pitch: /vehicles/1/components/1/messages/ATTITUDE/message/pitch
    heading: /vehicles/1/components/1/messages/VFR_HUD/message/heading
    vdop: /vehicles/1/components/1/messages/GPS_RAW_INT/message/vdop
    hdop: /vehicles/1/components/1/messages/GPS_RAW_INT/message/hdop
    satellites_visible: /vehicles/1/components/1/messages/GPS_RAW_INT/message/satellites_visible
    flight_mode: /vehicles/1/components/1/messages/HEARTBEAT/message/custom_mode
    arm_status: /vehicles/1/components/1/messages/HEARTBEAT/message/base_mode


# ==============================================================================
# VIDEO STREAMING OUTPUT (Dashboard/Client) - ENHANCED
# ==============================================================================
Streaming:
  # üñ•Ô∏è Enable HTTP/WebSocket video streaming to web dashboard
  ENABLE_STREAMING: true
  
  # === Server Settings ===
  HTTP_STREAM_HOST: 0.0.0.0      # 0.0.0.0 = all interfaces
  HTTP_STREAM_PORT: 5077          # Web dashboard port
  
  # === Stream Quality Settings ===
  STREAM_WIDTH: 640               # Output resolution
  STREAM_HEIGHT: 480              
  STREAM_FPS: 10                  # Target FPS (actual may vary)
  STREAM_QUALITY: 50              # Default JPEG quality (0-100)
  STREAM_PROCESSED_OSD: true      # Include overlays
  
  
  # === Frame Buffering ===
  ENABLE_FRAME_CACHE: true        # Cache encoded frames
  CACHE_TTL_MS: 100              # Cache time-to-live in ms
  MAX_FRAME_QUEUE: 3             # Max queued frames per client
  
  # === WebSocket Settings ===
  WS_MAX_CONNECTIONS: 10         # Max concurrent WebSocket clients
  WS_ENABLE_COMPRESSION: false   # Enable WebSocket compression
  

   # Adaptive Quality Control
  ENABLE_ADAPTIVE_QUALITY: true    # Set true for auto quality adjustment
  MIN_QUALITY: 30                   # Minimum JPEG quality (1-100)
  MAX_QUALITY: 85                   # Maximum JPEG quality (1-100)
  QUALITY_STEP: 10                  # Quality adjustment step size
  
  # Frame Caching (reduces CPU usage)
  ENABLE_FRAME_CACHE: true         # Set true to cache encoded frames
  CACHE_TTL_MS: 100                # Cache time-to-live in milliseconds
  SKIP_IDENTICAL_FRAMES: true     # Skip encoding if frame unchanged
  
  # Connection Limits
  HTTP_MAX_CONNECTIONS: 20         # Max concurrent HTTP streams
  WS_MAX_CONNECTIONS: 10           # Max concurrent WebSocket clients
  MAX_FRAME_QUEUE: 3               # Max queued frames per WebSocket client
  HTTP_CHUNK_SIZE: 65536         # Chunk size for streaming

  
  # === Performance ===
  ENCODING_THREADS: 2            # Parallel encoding threads
  ENABLE_HARDWARE_ENCODING: false # Use hardware encoder if available
  SKIP_IDENTICAL_FRAMES: true    # Skip encoding if frame unchanged
  FRAME_DIFFERENCE_THRESHOLD: 5  # Pixel difference threshold
  
  # === H.264 Streaming (Advanced) ===
  ENABLE_H264_STREAM: false      # Enable H.264/WebRTC streaming
  H264_BITRATE: 1000000          # H.264 bitrate (bps)
  H264_PROFILE: baseline         # H.264 profile (baseline/main/high)
  H264_PRESET: ultrafast         # Encoding preset

# ==============================================================================
# üéØ TRACKING MODE CONFIGURATION
# ==============================================================================
Tracking:
  # === Algorithm Selection ===
  # Options: CSRT (recommended for rotation), KCF (fast), Gimbal (external)
  # CSRT: Best for drone circling, rotation, perspective changes (15-20 FPS, 85% accuracy)
  # KCF:  Fast alternative for high-speed scenarios (25-30 FPS, 75% accuracy)
  DEFAULT_TRACKING_ALGORITHM: CSRT

  # === Global Visualization ===
  TRACKING_RECTANGLE_COLOR: [255, 0, 0]    # BGR: Blue
  CENTER_CIRCLE_COLOR: [0, 255, 0]         # BGR: Green
  CENTER_HISTORY_LENGTH: 10                # Trail length

  # === Global Tracking Limits ===
  MAX_DISPLACEMENT_THRESHOLD: 0.25         # Max jump as fraction of frame
  TRACKING_FAILURE_TIMEOUT: 5.0            # Seconds before re-detection
  REDETECTION_ATTEMPTS: 5                  # Max re-detection attempts

  # === Legacy Appearance Model (Deprecated - use tracker-specific configs) ===
  CONFIDENCE_THRESHOLD: 0.6                # ‚ö†Ô∏è Deprecated: Use tracker-specific
  APPEARANCE_THRESHOLD: 0.3
  APPEARANCE_CONFIDENCE_THRESHOLD: 0.5
  MOTION_CONFIDENCE_WEIGHT: 0.5
  APPEARANCE_CONFIDENCE_WEIGHT: 0.5
  CSRT_APPEARANCE_LEARNING_RATE: 0.05      # ‚ö†Ô∏è Deprecated: See CSRT_Tracker section
  
  # === Particle Filter Parameters (if using) ===
  PF_NUM_PARTICLES: 500                    # More = accurate but slower
  PF_INIT_POS_STD: 20.0                   # Initial position uncertainty
  PF_INIT_VEL_STD: 5.0                    # Initial velocity uncertainty
  PF_INIT_ACC_STD: 1.0                    # Initial acceleration uncertainty
  PF_POS_STD: 15.0                        # Process noise for position
  PF_VEL_STD: 5.0                         # Process noise for velocity
  PF_ACC_STD: 1.0                         # Process noise for acceleration
  PF_APPEARANCE_LIKELIHOOD_SCALE: 25.0    
  PF_APPEARANCE_LEARNING_RATE: 0.05       
  PF_COLOR_WEIGHT: 0.7                    # Color vs edge importance
  PF_EDGE_WEIGHT: 0.3
  PF_CANNY_THRESHOLD1: 50                 # Edge detection params
  PF_CANNY_THRESHOLD2: 150
  PF_EFFECTIVE_PARTICLE_NUM_THRESHOLD: 0.5
  PF_RANDOM_PARTICLE_RATIO: 0.1           # Random resampling ratio

# ==============================================================================
# üéØ KCF TRACKER CONFIGURATION (Kernelized Correlation Filter + Kalman)
# ==============================================================================
# Best for: High-speed tracking, CPU-limited systems, fast targets
# Performance: 25-30 FPS, ~75% success rate
# Limitations: Poor rotation invariance, moderate scale changes only
#
# Tuning Guide:
# - Target lost easily? ‚Üí ‚Üì confidence_threshold, ‚Üë failure_threshold
# - Tracker too slow? ‚Üí ‚Üì appearance_learning_rate
# - Rotation issues? ‚Üí ‚Üë appearance_learning_rate, ‚Üë max_scale_change
# - Jittery tracking? ‚Üí ‚Üì confidence_smoothing (more smoothing)
# ==============================================================================
KCF_Tracker:
  # === Robustness Parameters ===
  confidence_threshold: 0.2              # Min confidence to accept (0.0-1.0)
                                         # Lower = more tolerant, higher = stricter

  failure_threshold: 5                   # Consecutive failures before declaring lost
                                         # Higher = more robust, lower = faster re-detection

  confidence_smoothing: 0.7              # EMA alpha (0.0-1.0)
                                         # Higher = more responsive, lower = more stable

  # === Validation Limits ===
  max_scale_change_per_frame: 0.5        # Max size change per frame (0.0-1.0)
                                         # 0.5 = 50% scale change allowed

  max_motion_per_frame: 0.6              # Max motion as fraction of frame diagonal
                                         # Higher = allows faster movement

  # === Appearance Adaptation ===
  appearance_learning_rate: 0.15         # Adaptive learning speed (0.0-1.0)
                                         # Higher = faster adaptation (good for rotation)
                                         # Lower = more stable (good for static targets)

  # === Performance Tuning Presets ===
  # Conservative (high accuracy, slow adaptation):
  #   confidence_threshold: 0.3, failure_threshold: 3, appearance_learning_rate: 0.05
  # Balanced (recommended):
  #   confidence_threshold: 0.2, failure_threshold: 5, appearance_learning_rate: 0.15
  # Aggressive (maximum robustness, rotation-tolerant):
  #   confidence_threshold: 0.15, failure_threshold: 7, appearance_learning_rate: 0.20

# ==============================================================================
# üéØ CSRT TRACKER CONFIGURATION (Channel and Spatial Reliability Tracker)
# ==============================================================================
# Best for: Rotation, perspective changes, drone circling targets
# Performance: 15-20 FPS, ~85% success rate
# Strengths: Rotation-invariant, excellent scale adaptation, occlusion handling
#
# ==============================================================================
# üöÄ SIMPLE PERFORMANCE MODE - Choose based on your system:
# ==============================================================================
#
# "legacy"    - ORIGINAL CSRT (15-20 FPS) üîß CLASSIC
#               ‚úÖ Exact original implementation (proven stable)
#               ‚úÖ Zero overhead, maximum compatibility
#               ‚úÖ Always starts reliably when you click
#               ‚ö†Ô∏è May lose track during fast rotation/occlusions
#               Best for: Want original behavior, maximum speed
#
# "balanced"  - RECOMMENDED (12-18 FPS) ‚≠ê DEFAULT
#               ‚úÖ Reliable startup with grace period
#               ‚úÖ Smooth confidence tracking (EMA filtering)
#               ‚úÖ Good for drone circling targets
#               ‚úÖ Best speed/accuracy trade-off
#               Best for: Most use cases, general purpose
#
# "robust"    - PROFESSIONAL (10-15 FPS) üí™ ADVANCED
#               ‚úÖ Multi-frame failure tolerance
#               ‚úÖ Motion/scale validation against Kalman estimator
#               ‚úÖ Adaptive appearance learning
#               ‚úÖ Maximum stability during challenging scenarios
#               ‚ö†Ô∏è Requires more CPU resources
#               Best for: Critical missions, powerful hardware
#
# ==============================================================================
CSRT_Tracker:
  # === User-Friendly Performance Control (MAIN PARAMETER) ===
  performance_mode: "balanced"           # Choose: "legacy", "balanced", or "robust"
                                         # ‚≠ê Change this based on your needs!

  # === Advanced Parameters (Auto-configured by performance_mode) ===
  # ‚ÑπÔ∏è These are automatically set based on performance_mode above.
  # Only modify if you need fine-grained control.

  confidence_threshold: 0.5              # Min confidence to accept (0.0-1.0)
                                         # Auto: legacy=0.6, balanced=0.5, robust=0.4

  failure_threshold: 5                   # Consecutive failures before declaring lost
                                         # Auto: legacy=3, balanced=5, robust=5

  confidence_smoothing: 0.7              # EMA alpha (0.0-1.0)
                                         # Auto: legacy=N/A, balanced=0.7, robust=0.7

  validation_start_frame: 10             # Grace period before validation starts
                                         # Auto: legacy=999999, balanced=10, robust=5
                                         # ‚ö†Ô∏è Critical for reliable startup!

  max_scale_change_per_frame: 0.4        # Max size change per frame (0.0-1.0)
                                         # Auto: legacy=N/A, balanced=N/A, robust=0.4

  max_motion_per_frame: 0.5              # Max motion as fraction of frame diagonal
                                         # Auto: legacy=N/A, balanced=N/A, robust=0.5

  appearance_learning_rate: 0.08         # Adaptive learning speed (0.0-1.0)
                                         # Auto: legacy=0.05, balanced=0.08, robust=0.08

# ==============================================================================
# SMART TRACKER (YOLO-based AI Tracking)
# ==============================================================================
SmartTracker:
  # ü§ñ Enable AI-powered object tracking
  SMART_TRACKER_ENABLED: true

  # === Hardware Selection ===
  SMART_TRACKER_USE_GPU: true              # Try GPU first (CUDA)
  SMART_TRACKER_FALLBACK_TO_CPU: true      # Fall back if GPU fails

  # === Model Paths ===
  # üìÅ Use add_yolo_model.py to download/convert models
  # Simply replace these paths with your custom-trained YOLO model
  SMART_TRACKER_GPU_MODEL_PATH: "yolo/yolo11n.pt"          # PyTorch model
  SMART_TRACKER_CPU_MODEL_PATH: "yolo/yolo11n_ncnn_model"  # Optimized for ARM

  # === Detection Parameters ===
  SMART_TRACKER_CONFIDENCE_THRESHOLD: 0.3   # Min detection confidence (0.0-1.0)
  SMART_TRACKER_IOU_THRESHOLD: 0.3          # Overlap threshold for NMS (0.0-1.0)
  SMART_TRACKER_MAX_DETECTIONS: 20          # Max objects per frame

  # === Visual Settings ===
  SMART_TRACKER_COLOR: [0, 255, 255]        # BGR: Yellow
  SMART_TRACKER_SHOW_FPS: false

  # ==============================================================================
  # üéØ TRACKER TYPE SELECTION (Choose Your Tracking Strategy)
  # ==============================================================================
  #
  # üìä DECISION GUIDE:
  #
  # GPU System + Internet Access + Long Occlusions:
  #   ‚Üí Use "botsort_reid" (best accuracy, Ultralytics native ReID)
  #
  # CPU System / Raspberry Pi + Long Occlusions:
  #   ‚Üí Use "custom_reid" (lightweight, works offline, good re-ID on CPU)
  #
  # Air-gapped / Offline Drone:
  #   ‚Üí Use "custom_reid" (no internet needed, fully offline)
  #
  # High FPS Required (>30 FPS):
  #   ‚Üí Use "bytetrack" (fastest, disable ReID for maximum speed)
  #
  # Balanced Performance + Better Persistence:
  #   ‚Üí Use "botsort" (better than ByteTrack, no ReID overhead)
  #
  # üìä PERFORMANCE COMPARISON:
  #
  # Tracker Type    | FPS Impact | ReID Quality | Offline | GPU Needed | Ultralytics v8.3.114+
  # ----------------|------------|--------------|---------|------------|----------------------
  # bytetrack       | 0%         | None         | ‚úì       | No         | Any version
  # botsort         | -3-5%      | Low          | ‚úì       | No         | Any version
  # botsort_reid    | -5-8%      | Excellent    | ‚úó       | Recommended| Required
  # custom_reid     | -8-12%     | Good         | ‚úì       | No         | Any version
  #
  TRACKER_TYPE: "botsort_reid"

  # Options:
  # - "bytetrack": Fast, no ReID, geometric matching only
  # - "botsort": Better persistence, no ReID, geometric + better association
  # - "botsort_reid": BoT-SORT + Ultralytics native ReID (RECOMMENDED for GPU)
  # - "custom_reid": Lightweight histogram/HOG ReID (RECOMMENDED for CPU/offline)

  # ==============================================================================
  # ü§ñ BOT-SORT RE-IDENTIFICATION (Ultralytics Native ReID)
  # ==============================================================================
  # Only used when TRACKER_TYPE = "botsort_reid"
  # Requires Ultralytics v8.3.114+ (will auto-fallback to custom_reid if unavailable)

  # ReID embedding model selection
  # "auto": Uses native YOLO features (fastest, zero overhead, RECOMMENDED)
  # "yolo11n-cls.pt": Classification model (better accuracy, +2-5ms latency)
  # Custom path: Your own ReID embedding model
  BOTSORT_REID_MODEL: "auto"

  # Appearance similarity threshold for ReID matching
  # Lower = stricter matching (fewer false positives, may miss correct matches)
  # Higher = more lenient (more false positives, better recall)
  # ‚ö†Ô∏è NOTE: Opposite direction from APPEARANCE_MATCH_THRESHOLD!
  # Recommended: 0.20-0.30
  BOTSORT_APPEARANCE_THRESH: 0.25

  # IoU (geometric proximity) threshold for matching
  # Works alongside appearance threshold
  # Recommended: 0.4-0.6
  BOTSORT_PROXIMITY_THRESH: 0.5

  # Number of frames to remember lost tracks (for re-identification)
  # Higher = can recover after longer occlusions (uses more memory)
  # Recommended: 30-120 frames
  # 30 ‚âà 1 second, 60 ‚âà 2 seconds, 120 ‚âà 4 seconds at 30 FPS
  BOTSORT_TRACK_BUFFER: 60

  # IoU threshold for matching detections to existing tracks
  # Higher = stricter (fewer ID switches)
  # Lower = more lenient (better recovery)
  # Recommended: 0.7-0.9
  BOTSORT_MATCH_THRESH: 0.8

  # High confidence detection threshold (first association pass)
  # Recommended: 0.20-0.30
  BOTSORT_TRACK_HIGH_THRESH: 0.25

  # Low confidence detection threshold (recovery pass)
  # Recommended: 0.05-0.15
  BOTSORT_TRACK_LOW_THRESH: 0.1

  # Minimum confidence for creating new tracks
  # Lower = easier to start tracking
  # Higher = only track high-confidence objects
  # Recommended: 0.20-0.30
  BOTSORT_NEW_TRACK_THRESH: 0.25

  # Fuse detection confidence with IoU during matching
  # true = better discrimination (recommended)
  # false = pure geometric matching
  BOTSORT_FUSE_SCORE: true

  # Camera motion compensation method
  # "sparseOptFlow": Optical flow-based (recommended)
  # "none": Disable (use if camera is stationary)
  BOTSORT_CMC_METHOD: "sparseOptFlow"

  # ==============================================================================
  # üéØ ID TRACKING ROBUSTNESS (Hybrid Strategy - Works with All Tracker Types)
  # ==============================================================================
  # These parameters make tracking more robust when objects temporarily disappear
  # or when YOLO assigns new IDs to the same object

  # === Tracking Strategy ===
  # How to match tracked object across frames when ID changes
  # - "id_only": Strict ID matching (fastest, but loses track on ID change)
  # - "spatial_only": Position-based matching using IoU (works without IDs)
  # - "hybrid": ID first, falls back to spatial matching (RECOMMENDED)
  TRACKING_STRATEGY: "hybrid"

  # === ID Loss Tolerance ===
  # Number of frames to maintain tracking after losing track ID
  # Useful when object is briefly occluded or detector misses 1-2 frames
  # Higher = more forgiving, Lower = stricter (re-select needed sooner)
  # Recommended: 5-10 frames for drone tracking
  ID_LOSS_TOLERANCE_FRAMES: 5

  # === Spatial Matching ===
  # IoU threshold for matching by position when ID is lost
  # Higher = stricter matching (less false positives)
  # Lower = more lenient (might match wrong object)
  # Range: 0.0-1.0, Recommended: 0.3-0.5
  SPATIAL_IOU_THRESHOLD: 0.35

  # === Motion Prediction ===
  # Use velocity-based prediction to estimate object location during occlusion
  # Helps find object even if it moves while temporarily invisible
  # true = more robust to occlusions, false = simpler/faster
  ENABLE_PREDICTION_BUFFER: true

  # === Confidence Smoothing ===
  # Apply exponential moving average to detection confidence
  # Reduces jitter from frame-to-frame confidence variations
  # Higher = more smoothing, Lower = more responsive
  # Range: 0.0-1.0, Recommended: 0.7-0.9
  CONFIDENCE_SMOOTHING_ALPHA: 0.8

  # ==============================================================================
  # üîß BYTETRACK ADVANCED TUNING
  # ==============================================================================
  # These parameters control ByteTrack's internal tracking behavior
  # Normally you don't need to change these, but they're here for fine-tuning

  # === Track Persistence ===
  # Number of frames to keep track alive after losing detection
  # Higher = tracks survive longer occlusions
  # Lower = faster cleanup of lost tracks
  # Default: 30, Recommended for robust tracking: 50
  BYTETRACK_TRACK_BUFFER: 50

  # === Track Matching ===
  # IoU threshold for matching detections to existing tracks
  # Higher = stricter matching (less ID switches)
  # Lower = more lenient (may cause ID switches)
  # Range: 0.0-1.0, Recommended: 0.8
  BYTETRACK_MATCH_THRESH: 0.8

  # === New Track Creation ===
  # Confidence threshold for creating new tracks from detections
  # Lower = easier to start tracking new objects (good for re-acquisition)
  # Higher = only track high-confidence detections (fewer false positives)
  # Range: 0.0-1.0, Recommended: 0.20-0.25
  BYTETRACK_NEW_TRACK_THRESH: 0.20

  # === High/Low Confidence Thresholds ===
  # ByteTrack uses two-stage association (high conf ‚Üí low conf)
  # High threshold: First association pass (confident detections)
  # Low threshold: Second association pass (recover lost tracks)
  BYTETRACK_TRACK_HIGH_THRESH: 0.25
  BYTETRACK_TRACK_LOW_THRESH: 0.1

  # === Score Fusion ===
  # Combine detection confidence with IoU distance during matching
  # true = better handling of similar objects
  # false = pure geometric matching
  BYTETRACK_FUSE_SCORE: true

  # ==============================================================================
  # üé® APPEARANCE-BASED RE-IDENTIFICATION (Advanced Feature)
  # ==============================================================================
  # Enables object re-identification after long occlusions using visual appearance
  # Useful when object disappears for >5 frames and returns with different ID
  # Maintains original track ID even after long disappearances

  # === Feature Toggle ===
  # Set to false on low-performance boards (Raspberry Pi Zero, older ARM)
  # Adds ~5-10ms per frame overhead on modern hardware
  ENABLE_APPEARANCE_MODEL: true

  # === Similarity Threshold ===
  # How similar appearances must be to consider a match (0.0-1.0)
  # Higher = stricter matching (fewer false positives, may miss correct matches)
  # Lower = more lenient (more false positives, better recall)
  # Recommended values:
  #   - 0.8-0.9: Very strict (use when objects look very similar)
  #   - 0.6-0.7: Balanced (recommended for most scenarios)
  #   - 0.4-0.5: Lenient (use when lighting/angle changes dramatically)
  APPEARANCE_MATCH_THRESHOLD: 0.7

  # === Feature Extraction Method ===
  # Determines what visual features are used for matching
  # "histogram": Fast, color-based matching
  #   - Best for: Objects with distinct colors
  #   - Speed: Fastest (~2-3ms per object)
  #   - Accuracy: Good for color-distinct objects
  #   - Recommended for: Embedded systems, colored targets
  #
  # "hog": Shape/texture-based matching (Histogram of Oriented Gradients)
  #   - Best for: Similar colors but different shapes
  #   - Speed: Moderate (~5-7ms per object)
  #   - Accuracy: Better for shape discrimination
  #   - Recommended for: Monochrome or similar-colored objects
  #
  # "hybrid": Combines histogram + HOG features
  #   - Best for: Maximum accuracy in challenging scenarios
  #   - Speed: Slower (~8-10ms per object)
  #   - Accuracy: Highest overall
  #   - Recommended for: Powerful hardware, critical applications
  APPEARANCE_FEATURE_TYPE: "histogram"

  # === Memory Window ===
  # How long to remember lost objects (in frames)
  # Object features are stored for this duration after losing track
  # Higher = can re-identify after longer occlusions (uses more memory ~1KB per object)
  # Lower = faster cleanup, less memory usage
  # Recommended values:
  #   - 30 frames: ~1 second at 30 FPS (good for brief occlusions)
  #   - 60 frames: ~2 seconds (balanced)
  #   - 150 frames: ~5 seconds (long occlusions, uses more memory)
  MAX_REIDENTIFICATION_FRAMES: 30

  # === Adaptive Learning ===
  # Update appearance model during successful tracking
  # Helps adapt to gradual changes in lighting, viewing angle, or object appearance
  # true = model adapts over time (better for changing conditions)
  # false = uses initial appearance only (more consistent but rigid)
  APPEARANCE_ADAPTIVE_LEARNING: true

  # Learning rate for adaptive updates (0.0-1.0)
  # Higher = faster adaptation to changes (may drift from original appearance)
  # Lower = slower adaptation (more stable, less responsive to changes)
  # Recommended: 0.05-0.15
  APPEARANCE_LEARNING_RATE: 0.1

  # === HOG Feature Parameters ===
  # Only used when APPEARANCE_FEATURE_TYPE = "hog" or "hybrid"
  # Histogram of Oriented Gradients configuration for shape-based matching
  HOG_WIN_SIZE: [64, 64]              # ROI resize dimensions (width, height)
  HOG_BLOCK_SIZE: [16, 16]            # Block size for normalization
  HOG_BLOCK_STRIDE: [8, 8]            # Step size for block overlap
  HOG_CELL_SIZE: [8, 8]               # Cell size within blocks
  HOG_NBINS: 9                        # Number of orientation bins (1-180 degrees)

  # === Color Histogram Parameters ===
  # Only used when APPEARANCE_FEATURE_TYPE = "histogram" or "hybrid"
  HIST_H_BINS: 30                     # Hue channel bins (H in HSV)
  HIST_S_BINS: 32                     # Saturation channel bins (S in HSV)

  # === Performance Profiling ===
  # Enable profiling to measure feature extraction and matching performance
  ENABLE_APPEARANCE_PROFILING: false  # true = log timing metrics to console


# ==============================================================================
# GIMBAL TRACKER CONFIGURATION (New Feature)
# ==============================================================================
GimbalTracker:
  # Enable/disable gimbal tracker
  ENABLED: true

  # Network configuration for gimbal UDP communication
  UDP_HOST: "192.168.0.108"      # Gimbal IP address
  UDP_PORT: 9003                # Gimbal UDP port
  CONNECTION_TIMEOUT: 5.0       # Connection timeout in seconds

# Global gimbal parameters (accessed by GimbalTracker and GimbalInterface)
GIMBAL_UDP_HOST: "192.168.0.108"      # Gimbal IP address
GIMBAL_LISTEN_PORT: 9004               # Port for listening to gimbal data
GIMBAL_COORDINATE_SYSTEM: "GIMBAL_BODY"  # Coordinate system preference
GIMBAL_DISABLE_ESTIMATOR: true         # Disable Kalman estimator for gimbal

GimbalTrackerSettings:
  # Coordinate system configuration
  COORDINATE_SYSTEM: "GIMBAL_BODY"  # Options: "GIMBAL_BODY", "SPATIAL_FIXED"

  # Camera mount offsets (degrees relative to aircraft body frame)
  CAMERA_MOUNT_OFFSET_ROLL: 0.0    # Roll offset
  CAMERA_MOUNT_OFFSET_PITCH: 0.0   # Pitch offset (+ = nose down from aircraft)
  CAMERA_MOUNT_OFFSET_YAW: 0.0     # Yaw offset (+ = right from aircraft nose)

  # Validation limits
  YAW_LIMIT: 180.0              # Maximum yaw angle (degrees)
  PITCH_LIMIT: 90.0             # Maximum pitch angle (degrees)
  ROLL_LIMIT: 180.0             # Maximum roll angle (degrees)

  # Processing configuration
  SUPPRESS_DETECTOR: true       # Disable image detector (not needed for gimbal)
  SUPPRESS_PREDICTOR: true      # Disable predictor (not needed for gimbal)
  DISABLE_ESTIMATOR: true       # Disable Kalman estimator (gimbal provides direct data)

  # Data quality parameters
  MAX_DATA_AGE: 5.0            # Maximum age of data to consider valid (seconds)


# ==============================================================================
# FOLLOWER MODE (Drone Following Behavior)
# ==============================================================================
Follower:
  # === Interface Settings ===
  USE_MAVLINK2REST: true                    # Use REST API for MAVLink
  FOLLOWER_DATA_REFRESH_RATE: 5             # Hz

  # === Target Selection ===
  ROI_SELECTION_MODE: MANUAL                # MANUAL or AUTO
  TARGET_POSITION_MODE: center              # center, top, bottom

  # === Following Mode ===
  # Options: ground_view, constant_distance, constant_position, chase_follower, body_velocity_chase, gimbal_unified
  FOLLOWER_MODE: constant_position
  
  # === Visualization ===
  SHOW_TRACKING_WINDOW: false               # Debug window
  DISPLAY_DEVIATIONS: false                 # Show error vectors
  TRACKED_BBOX_STYLE: fancy                 # simple or fancy
  FOLLOWER_ACTIVE_COLOR: [0, 0, 255]       # BGR: Red when active
  FOLLOWER_INACTIVE_COLOR: [0, 255, 255]   # BGR: Yellow when inactive
  BBOX_LINE_THICKNESS: 2
  EXTENDED_LINE_THICKNESS: 2
  CORNER_DOT_RADIUS: 4
  CROSSHAIR_ARM_LENGTH: 20
  BBOX_CORNER_ARM_LENGTH: 20
  OVERLAY_OPACITY: 128

# === Circuit Breaker (Safety & Testing) ===
# SAFETY FIRST: Global circuit breaker for follower testing without drone commands
# Default: true (SAFE) - Only set to false when you explicitly want to send real commands
FOLLOWER_CIRCUIT_BREAKER: true            # true = SAFE (log only), false = LIVE (send commands)
CIRCUIT_BREAKER_DISABLE_SAFETY: true      # true = Skip safety checks in CB mode, false = Run all checks


# ==============================================================================
# GIMBAL FOLLOWER CONFIGURATION
# ==============================================================================
GimbalFollower:
  # === Mount Configuration ===
  MOUNT_TYPE: "VERTICAL"                    # Options: "HORIZONTAL", "VERTICAL"
  CONTROL_MODE: "BODY"                      # Options: "NED", "BODY"

  # === Required Tracker Fields ===
  REQUIRED_TRACKER_FIELDS: ["angular"]     # Must have angular data from gimbal

  # === Velocity Control ===
  BASE_VELOCITY: 2.0                       # Base following velocity (m/s)
  MAX_VELOCITY: 8.0                        # Maximum velocity limit (m/s)
  VELOCITY_RAMP_RATE: 1.0                  # Acceleration rate (m/s¬≤)
  VELOCITY_FILTER_ALPHA: 0.7               # Velocity smoothing filter coefficient (0-1)

  # === Forward Velocity Control System ===
  # Based on 2024 guidance control research for reliable target interception
  FORWARD_VELOCITY_MODE: "CONSTANT"        # Options: "CONSTANT", "PITCH_BASED", "PROPORTIONAL_NAV" (future)
  BASE_FORWARD_SPEED: 2.0                  # Constant forward speed (m/s)
  MAX_FORWARD_VELOCITY: 5.0                # Maximum forward velocity limit (m/s)
  FORWARD_ACCELERATION: 2.0                # Ramp rate from current to target speed (m/s¬≤)

  # === Lateral Guidance Mode ===
  LATERAL_GUIDANCE_MODE: "coordinated_turn" # Options: "coordinated_turn", "sideslip"
  ENABLE_AUTO_MODE_SWITCHING: false        # Auto-switch based on forward velocity
  GUIDANCE_MODE_SWITCH_VELOCITY: 3.0       # Switch velocity threshold (m/s)

  # === Yaw Control ===
  MAX_YAW_RATE: 45.0                      # Maximum yaw rate (degrees/second)

  # === Target Loss Handling ===
  TARGET_LOSS_HANDLING:
    CONTINUE_VELOCITY_TIMEOUT: 3.0         # Continue last velocity for N seconds
    ENABLE_RTL_ON_TIMEOUT: true            # Trigger RTL after timeout
    RTL_ALTITUDE: 50.0                     # RTL altitude (meters)

    # === Enhanced Timeout Behaviors (PHASE 3.2) ===
    ENABLE_ADAPTIVE_TIMEOUT: true          # Adjust timeout based on target movement/confidence
    ADAPTIVE_TIMEOUT_FACTOR: 1.5           # Multiplier for fast-moving targets
    ENABLE_PREDICTIVE_VELOCITY: true       # Use movement prediction during loss
    PREDICTION_HISTORY_SIZE: 5             # Number of samples for prediction
    CONFIDENCE_TIMEOUT_ADJUSTMENT: true    # Adjust timeout based on tracking confidence
    HIGH_CONFIDENCE_THRESHOLD: 0.8         # High confidence threshold
    LOW_CONFIDENCE_THRESHOLD: 0.3          # Low confidence threshold

  # === Safety Parameters ===
  MIN_ALTITUDE_SAFETY: 3.0                # Minimum safe altitude (meters)
  MAX_ALTITUDE_SAFETY: 120.0              # Maximum safe altitude (meters)
  MAX_SAFETY_VIOLATIONS: 5                # Maximum allowed safety violations before blocking
  SAFETY_RETURN_SPEED: 3.0                # Velocity when returning to safe altitude (m/s)
  EMERGENCY_STOP_ENABLED: true            # Enable emergency velocity zeroing

  # === Circuit Breaker Safety Override ===
  CIRCUIT_BREAKER_DISABLE_SAFETY: true    # Disable safety checks when circuit breaker is active (testing mode)

  # === Coordinate Transformation ===
  ANGLE_DEADZONE: 2.0                     # Ignore gimbal movements below this (degrees)
  TRANSFORMATION_VALIDATION: true         # Validate coordinate transformations

  # === Enhanced Transformation Parameters ===
  # NOTE: NEUTRAL_PITCH_ANGLE is now handled automatically based on MOUNT_TYPE
  # VERTICAL mount: neutral = 90¬∞ (level), HORIZONTAL mount: uses configured value
  NEUTRAL_PITCH_ANGLE: 0.0                # Neutral pitch for HORIZONTAL mount only (degrees)
  PITCH_VELOCITY_SCALING: 0.15            # Pitch error to velocity scaling factor
  PITCH_DEADZONE_DEGREES: 2.0             # Pitch deadzone to prevent jitter (degrees)
  MAX_ROLL_ANGLE: 90.0                    # Maximum expected roll range (degrees)
  MAX_PITCH_ANGLE: 90.0                   # Maximum expected pitch range (degrees)
  INVERT_LATERAL_CONTROL: false           # Invert lateral control for different gimbal orientations
  INVERT_VERTICAL_CONTROL: true          # Invert vertical control for different gimbal orientations

  # === Gimbal Direction Conventions ===
  # Configure these based on your specific gimbal's angle reporting convention
  ROLL_RIGHT_SIGN: "POSITIVE"             # "POSITIVE" if look_right=positive_roll, "NEGATIVE" if look_right=negative_roll

  # === Default Values for Optional Features ===
  DEFAULT_THRUST: 0.5                     # Default thrust for attitude rate control mode

  # === Performance ===
  UPDATE_RATE: 20.0                       # Control loop frequency (Hz)
  COMMAND_SMOOTHING_ENABLED: true         # Enable velocity command smoothing
  SMOOTHING_FACTOR: 0.8                   # Smoothing coefficient (0-1)

BODY_VELOCITY_CHASE:
  # === Forward Velocity Ramping ===
  INITIAL_FORWARD_VELOCITY: 0.0           # m/s - starting velocity
  MAX_FORWARD_VELOCITY: 0.5               # m/s - maximum chase speed
  FORWARD_RAMP_RATE: 0.5                 # m/s¬≤ - acceleration rate
  RAMP_DOWN_ON_TARGET_LOSS: true          # Decelerate when target lost
  TARGET_LOSS_TIMEOUT: 2.0                # seconds before ramp down starts
  
  # === Control Enablement ===
  ENABLE_ALTITUDE_CONTROL: false           # Enable down velocity control
  
  # === üß≠ LATERAL GUIDANCE MODES ===
  # Two guidance strategies for lateral target tracking:
  # - sideslip: Direct lateral velocity (v_right ‚â† 0, yaw_rate = 0)
  #   Best for: Precision hovering, close proximity, confined spaces
  # - coordinated_turn: Turn-to-track (v_right = 0, yaw_rate ‚â† 0) 
  #   Best for: Forward flight efficiency, natural behavior, wind resistance
  LATERAL_GUIDANCE_MODE: coordinated_turn     # sideslip | coordinated_turn
  GUIDANCE_MODE_SWITCH_VELOCITY: 3.0          # m/s - auto-switch threshold
  ENABLE_AUTO_MODE_SWITCHING: false          # Auto-switch based on forward velocity
  
  # === üõ°Ô∏è ALTITUDE SAFETY (Body Velocity Chase Specific) ===
  ALTITUDE_SAFETY_ENABLED: false          # Enable altitude monitoring  
  MIN_ALTITUDE_LIMIT: 5.0               # meters - trigger RTL below this
  MAX_ALTITUDE_LIMIT: 50.0              # meters - trigger RTL above this
  ALTITUDE_CHECK_INTERVAL: 1.0           # seconds - check frequency
  RTL_ON_ALTITUDE_VIOLATION: true        # Trigger RTL on violation
  ALTITUDE_WARNING_BUFFER: 2.0           # meters - warning zone before limits
  
  # === Safety Limits (Additional to Schema Limits) ===
  EMERGENCY_STOP_ENABLED: true            # Enable emergency velocity zeroing
  MAX_TRACKING_ERROR: 1.5                 # Max normalized error before limiting
  VELOCITY_SMOOTHING_ENABLED: true       # Enable velocity command smoothing
  SMOOTHING_FACTOR: 0.8                  # Smoothing coefficient (0-1)
  
  # === Performance Tuning ===
  MIN_FORWARD_VELOCITY_THRESHOLD: 0.2    # m/s - minimum velocity to maintain (important if using a fixedwing or VTOL)
  RAMP_UPDATE_RATE: 10.0                 # Hz - forward velocity update frequency
  PID_UPDATE_RATE: 20.0                  # Hz - tracking PID update frequency

# ==============================================================================
# CONSTANT POSITION FOLLOWER CONFIGURATION
# ==============================================================================
CONSTANT_POSITION:
  # === Control Enablement ===
  ENABLE_ALTITUDE_CONTROL: false           # Enable vel_z control
  ENABLE_YAW_CONTROL: true                # Always enabled for this mode

  # === Altitude Parameters ===
  MIN_DESCENT_HEIGHT: 3.0                 # Minimum safe altitude (meters)
  MAX_CLIMB_HEIGHT: 120.0                 # Maximum altitude (meters)
  MAX_VERTICAL_VELOCITY: 3.0              # Max vertical velocity (m/s)

  # === Yaw Control ===
  MAX_YAW_RATE: 10.0                      # Max yaw rate (deg/s)
  YAW_CONTROL_THRESHOLD: 0.02             # Dead zone threshold (normalized)

  # === Safety & Performance ===
  TARGET_LOST_TIMEOUT: 3.0                # Target loss timeout (seconds)
  CONTROL_UPDATE_RATE: 20.0               # Control loop frequency (Hz)
  COMMAND_SMOOTHING_ENABLED: true         # Enable velocity smoothing
  SMOOTHING_FACTOR: 0.8                   # Smoothing coefficient (0-1)

# ==============================================================================
# CONSTANT DISTANCE FOLLOWER CONFIGURATION
# ==============================================================================
CONSTANT_DISTANCE:
  # === Control Enablement ===
  ENABLE_YAW_CONTROL: false              # Enable yaw rate control for target centering
  ENABLE_ALTITUDE_CONTROL: false          # Enable bidirectional altitude control

  # === Altitude Parameters ===
  MIN_DESCENT_HEIGHT: 3.0                # Minimum safe altitude (meters)
  MAX_CLIMB_HEIGHT: 120.0                # Maximum altitude (meters)
  MAX_VERTICAL_VELOCITY: 5.0             # Max vertical velocity (m/s)

  # === Lateral Control ===
  MAX_LATERAL_VELOCITY: 10.0             # Max lateral velocity (m/s)

  # === Yaw Control ===
  MAX_YAW_RATE: 10.0                     # Max yaw rate (deg/s)
  YAW_CONTROL_THRESHOLD: 0.3             # Dead zone threshold (normalized)

  # === Safety & Performance ===
  TARGET_LOST_TIMEOUT: 3.0               # Target loss timeout (seconds)
  CONTROL_UPDATE_RATE: 20.0              # Control loop frequency (Hz)
  COMMAND_SMOOTHING_ENABLED: true        # Enable velocity smoothing
  SMOOTHING_FACTOR: 0.8                  # Smoothing coefficient (0-1)

  # === Distance Maintenance ===
  DISTANCE_HOLD_ENABLED: true            # Maintain constant forward distance
  DISTANCE_HOLD_TOLERANCE: 0.1           # Distance tolerance (normalized)

# ==============================================================================
# CHASE FOLLOWER CONFIGURATION
# ==============================================================================
CHASE_FOLLOWER:
  # === Control Enablement ===
  YAW_ERROR_CHECK_ENABLED: true         # Enable yaw error gating for safety
  ALTITUDE_FAILSAFE_ENABLED: false      # Enable altitude safety monitoring

  # === Rate Limits ===
  MAX_PITCH_RATE: 10.0                  # Max pitch rate (deg/s)
  MAX_YAW_RATE: 10.0                    # Max yaw rate (deg/s)
  MAX_ROLL_RATE: 20.0                   # Max roll rate (deg/s)
  MAX_BANK_ANGLE: 20.0                  # Max bank angle for coordinated turns (deg)

  # === Speed Control ===
  TARGET_SPEED: 60.0                    # Target chase speed (units depend on normalization)
  MIN_GROUND_SPEED: 0.0                 # Minimum ground speed for normalization (m/s)
  MAX_GROUND_SPEED: 100.0               # Maximum ground speed for normalization (m/s)

  # === Thrust Control ===
  MIN_THRUST: 0.3                       # Minimum thrust value (0-1)
  MAX_THRUST: 1.0                       # Maximum thrust value (0-1)

  # === Safety Thresholds ===
  YAW_ERROR_THRESHOLD: 20.0             # Yaw error threshold for dive activation (deg)

  # === Altitude Limits (when failsafe enabled) ===
  MIN_DESCENT_HEIGHT: 40.0              # Minimum safe altitude (meters)
  MAX_CLIMB_HEIGHT: 10000.0             # Maximum altitude (meters)

  # === Performance Tuning ===
  CONTROL_UPDATE_RATE: 20.0             # Control loop frequency (Hz)
  COORDINATE_TURN_ENABLED: true         # Enable coordinated turn dynamics
  AGGRESSIVE_MODE: true                 # Enable aggressive chase behavior

# ==============================================================================
# GROUND VIEW FOLLOWER CONFIGURATION
# ==============================================================================
GROUND_VIEW:
  # === Target Position Mode ===
  TARGET_POSITION_MODE: center          # Target positioning: "center", "initial"

  # === Velocity Limits ===
  MAX_VELOCITY_X: 10.0                  # Max lateral velocity (m/s)
  MAX_VELOCITY_Y: 10.0                  # Max longitudinal velocity (m/s)
  MAX_RATE_OF_DESCENT: 2.0              # Max descent rate (m/s)

  # === Descent Control ===
  ENABLE_DESCEND_TO_TARGET: false       # Enable automatic descent to target
  MIN_DESCENT_HEIGHT: 40.0              # Minimum safe descent altitude (meters)

  # === Gimbal Corrections ===
  IS_CAMERA_GIMBALED: false             # Camera stabilization status
  BASE_ADJUSTMENT_FACTOR_X: 0.1         # Base correction factor for roll (X-axis)
  BASE_ADJUSTMENT_FACTOR_Y: 0.1         # Base correction factor for pitch (Y-axis)

  # === Altitude Adjustments ===
  ALTITUDE_FACTOR: 0.005                # Altitude scaling factor for distance compensation

  # === Gain Scheduling ===
  ENABLE_GAIN_SCHEDULING: false         # Enable adaptive gain scheduling
  GAIN_SCHEDULING_PARAMETER: current_altitude  # Parameter for gain scheduling

  # === Performance Tuning ===
  CONTROL_UPDATE_RATE: 20.0             # Control loop frequency (Hz)
  COORDINATE_CORRECTIONS_ENABLED: true  # Enable gimbal and altitude corrections
  ERROR_LOGGING_ENABLED: true           # Enable detailed error logging

# ==============================================================================
# DETECTOR CONFIGURATION
# ==============================================================================
Detector:
  # üîç Object detection for tracker initialization/recovery
  USE_DETECTOR: true
  DETECTION_ALGORITHM: TemplateMatching     # or FeatureMatching, YOLO
  
  # ==============================================================================
  # üîç TEMPLATE MATCHING (Re-detection for all trackers)
  # ==============================================================================
  # Used when tracker loses target - attempts to re-detect using template matching
  # Multi-scale search allows finding target at different sizes (zoom in/out)
  # ==============================================================================
  TEMPLATE_MATCHING_METHOD: TM_CCOEFF_NORMED
  TEMPLATE_UPDATE_INTERVAL: 10              # Frames between template updates
  TEMPLATE_APPEARANCE_LEARNING_RATE: 0.002  # Template adaptation speed

  # Multi-scale search (0.5x to 2x target size for drone scenarios)
  TEMPLATE_MATCHING_SCALES: [0.5, 0.7, 0.8, 0.9, 1.0, 1.1, 1.2, 1.5, 2.0]
  TEMPLATE_MATCHING_THRESHOLD: 0.7          # Match confidence threshold

  APPEARANCE_CONFIDENCE_THRESHOLD: 0.7      # Re-detection validation
  TRACKER_CONFIDENCE_THRESHOLD_FOR_TEMPLATE_UPDATE: 0.8
  
  # === Feature Matching ===
  DEFAULT_FEATURE_EXTRACTION_ALGORITHM: ORB  # or SIFT, SURF
  ORB_NFEATURES: 500
  ORB_MIN_MATCH_COUNT: 30
  RANSAC_REPROJECTION_THRESHOLD: 10.0
  
  # === Re-detection Parameters ===
  AUTO_REDETECT: true
  REDETECTION_SEARCH_RADIUS: 300            # Pixels
  MIN_SEARCH_RADIUS: 50
  UNCERTAINTY_SCALE_FACTOR: 2.0
  ESTIMATOR_UNCERTAINTY_THRESHOLD: 1000.0

# ==============================================================================
# GSTREAMER PIPELINE TEMPLATES
# ==============================================================================
# üîß Advanced users can edit these templates
# Variables: {width}, {height}, {fps}, {device_id}, {url}, {latency}
GStreamerPipelines:
  # USB camera pipelines
  USB_YUYV: "v4l2src device=/dev/video{device_id} ! video/x-raw,format=YUY2,width={width},height={height},framerate={fps}/1 ! videoconvert ! video/x-raw,format=BGR ! appsink drop=true max-buffers=1 sync=false"
  
  USB_MJPEG: "v4l2src device=/dev/video{device_id} ! image/jpeg,width={width},height={height},framerate={fps}/1 ! jpegdec ! videoconvert ! video/x-raw,format=BGR ! appsink drop=true max-buffers=1 sync=false"
  
  # CSI camera pipelines
  CSI_NVIDIA: "nvarguscamerasrc sensor-id={sensor_id} ! video/x-raw(memory:NVMM),width={width},height={height},format=NV12,framerate={fps}/1 ! nvvidconv flip-method={flip_method} ! video/x-raw,format=BGRx ! videoconvert ! video/x-raw,format=BGR ! appsink drop=true sync=false"
  
  CSI_RPI: "libcamerasrc ! video/x-raw,width={width},height={height},framerate={fps}/1 ! videoconvert ! video/x-raw,format=BGR ! appsink drop=true sync=false"
  
  # Network stream pipelines
  RTSP: "rtspsrc location={url} latency={latency} ! decodebin ! videoconvert ! video/x-raw,format=BGR ! videoscale ! video/x-raw,width={width},height={height} ! appsink drop=true sync=false"
  
  UDP: "udpsrc uri={url} ! application/x-rtp ! rtph264depay ! avdec_h264 ! videoconvert ! video/x-raw,format=BGR ! videoscale ! video/x-raw,width={width},height={height} ! appsink drop=true sync=false"
  
  HTTP: "souphttpsrc location={url} ! decodebin ! videoconvert ! video/x-raw,format=BGR ! videoscale ! video/x-raw,width={width},height={height} ! appsink drop=true sync=false"

# ==============================================================================
# FRAME WINDOW & DISPLAY
# ==============================================================================
FrameEstimation:
  # üñºÔ∏è Video display window settings
  FRAME_TITLE: Video                        # Window title
  DEFAULT_FPS: 30                           # DEPRECATED: Use VideoSource/DEFAULT_FPS
  SHOW_VIDEO_WINDOW: false                  # true for debugging with display

# ==============================================================================
# ESTIMATOR (Kalman Filter for Tracking)
# ==============================================================================
Estimator:
  # üìä State estimation for smooth tracking
  USE_ESTIMATOR: true
  ESTIMATOR_TYPE: Kalman                    # Options: Kalman, None
  ESTIMATOR_ENABLED: true                   # DEPRECATED: Use USE_ESTIMATOR
  ESTIMATOR_HISTORY_LENGTH: 5               # State history buffer
  
  # === Kalman Filter Parameters ===
  ESTIMATOR_PROCESS_NOISE_VARIANCE: 10.0    # Motion uncertainty
  ESTIMATOR_MEASUREMENT_NOISE_VARIANCE: 1.0 # Sensor noise
  # Initial covariance: [x, y, dx, dy, ddx, ddy]
  ESTIMATOR_INITIAL_STATE_COVARIANCE: [5, 5, 50, 50, 100, 100]
  
  # === Usage ===
  USE_ESTIMATOR_FOR_FOLLOWING: true         # Use predictions for control
  
  # === Visualization ===
  ESTIMATED_POSITION_COLOR: [255, 0, 0]     # Blue: tracking active
  ESTIMATION_ONLY_COLOR: [0, 165, 255]      # Orange: prediction only

# ==============================================================================
# FRAME PREPROCESSING
# ==============================================================================
FramePreprocessor:
  # üé® Image enhancement for better tracking
  ENABLE_PREPROCESSING: true
  
  # === Blur (noise reduction) ===
  PREPROCESSING_USE_BLUR: true
  PREPROCESSING_BLUR_KERNEL_SIZE: 5         # Must be odd (3, 5, 7...)
  PREPROCESSING_USE_MEDIAN_BLUR: false
  PREPROCESSING_MEDIAN_BLUR_KERNEL_SIZE: 5
  
  # === Contrast Enhancement ===
  PREPROCESSING_USE_CLAHE: true             # Adaptive histogram equalization
  PREPROCESSING_CLAHE_CLIP_LIMIT: 2.0       # Contrast limit
  PREPROCESSING_CLAHE_TILE_GRID_SIZE: 8     # Grid size (1-10)
  
  # === Color Space ===
  PREPROCESSING_COLOR_SPACE: BGR            # Options: BGR, GRAY, HSV, LAB

# ==============================================================================
# SEGMENTATION
# ==============================================================================
Segmentation:
  # üé≠ Object segmentation for precise tracking
  SEGMENTATION_ALGORITHMS: ['GrabCut', 'Watershed', 'yolov8s-seg', 'yolov8n-oiv7', 'yolov8s-obb','yolov11n']
  DEFAULT_SEGMENTATION_ALGORITHM: yolov11n.pt
  USE_SEGMENTATION_FOR_TRACKING: true
  
  # === Morphological Operations ===
  MORPHOLOGICAL_KERNEL_SIZE: 5
  DILATION_ITERATIONS: 2
  EROSION_ITERATIONS: 1
  
  # === GrabCut Parameters ===
  SEGMENTATION_GRABCUT_ITER: 5
  SEGMENTATION_MIN_AREA: 500                # Min segment area in pixels

# ==============================================================================
# YAW CONTROL
# ==============================================================================
YawControl:
  # üîÑ Drone yaw (heading) control
  ENABLE_YAW_CONTROL: false
  YAW_CONTROL_THRESHOLD: 0.3                # Activation threshold
  YAW_LATERAL_BLEND_FACTOR: 0.5             # Blend yaw with lateral motion
  YAW_DEAD_ZONE: 0.2                        # Ignore small errors

# ==============================================================================
# VERTICAL ERROR RECALCULATION
# ==============================================================================
VerticalErrorRecalculation:
  # üìê Altitude control parameters
  VERTICAL_RECALC_DELAY: 0.1                # Seconds
  YAW_PITCH_SYNC_FACTOR: 0.5                # Coupling factor

# ==============================================================================
# GIMBAL CONTROL
# ==============================================================================
Gimbal:
  # üì∑ Camera gimbal settings
  ENABLE_GIMBAL_PRIORITY: true              # Gimbal overrides body motion

# ==============================================================================
# ADAPTIVE CONTROL
# ==============================================================================
AdaptiveControl:
  # üîß Adaptive control features
  ADAPTIVE_YAW_CONTROL: false               # Auto-tune yaw gains

# ==============================================================================
# CHASE FOLLOWER LIMITS
# ==============================================================================
ChaseFollower:
  # üöÅ Safety limits for chase mode
  MAX_ROLL_RATE: 20.0                      # deg/s
  MAX_PITCH_RATE: 10.0                     # deg/s
  MAX_YAW_RATE: 10.0                       # deg/s
  MAX_THRUST: 1.0                          # 0-1
  MIN_THRUST: 0.3                          # 0-1
  MIN_GROUND_SPEED: 0                      # m/s
  MAX_GROUND_SPEED: 100                    # m/s
  TARGET_SPEED: 60                         # m/s
  MAX_BANK_ANGLE: 20                       # degrees
  YAW_ERROR_CHECK_ENABLED: true
  YAW_ERROR_THRESHOLD: 20                  # degrees
  ALTITUDE_FAILSAFE_ENABLED: false

# ==============================================================================
# PID CONTROLLER
# ==============================================================================
PID:
  # ‚öôÔ∏è PID gains for each control axis
  PID_GAINS:
    x: {p: 4.5, i: 0.1, d: 1.5}            # Lateral
    y: {p: 4.5, i: 0.1, d: 1.5}            # Longitudinal  
    z: {p: 2, i: 0.03, d: 0.05}            # Vertical
    roll_rate: {p: 1, i: 0.05, d: 0.2}
    pitch_rate: {p: 20, i: 0.1, d: 0.4}
    yaw_rate: {p: 0.5, i: 0.01, d: 0.1}
    thrust: {p: 0.1, i: 3, d: 1}
    vel_body_right: {p: 1.0, i: 0.02, d: 0.1}
    vel_body_down: {p: 1.0, i: 0.05, d: 0.1}
    yawspeed_deg_s: {p: 0.5, i: 0.01, d: 0.1}  # Yaw rate (coordinated turn mode)
  # === Advanced PID Features ===
  PROPORTIONAL_ON_MEASUREMENT: false        # Avoid derivative kick
  ENABLE_ANTI_WINDUP: true                  # Prevent integral windup
  ANTI_WINDUP_BACK_CALC_COEFF: 0.1         # Back-calculation coefficient

# ==============================================================================
# VELOCITY & SAFETY LIMITS
# ==============================================================================
VelocityDescent:
  # üõ°Ô∏è Safety limits and control parameters
  VELOCITY_LIMITS:
    x: 10.0                                 # Max lateral velocity (m/s)
    y: 10.0                                 # Max longitudinal velocity (m/s)
    z: 5.0                                  # Max vertical velocity (m/s)
    vel_body_fwd: 15.0
    vel_body_right: 8.0  
    vel_body_down: 5.0
    yawspeed_deg_s: 10.0
  
  # === Altitude Control ===
  ENABLE_DESCEND_TO_TARGET: false          # Follow target down
  MIN_DESCENT_HEIGHT: 40                   # Min altitude (m)
  MAX_CLIMB_HEIGHT: 10000                  # Max altitude (m)
  MAX_RATE_OF_DESCENT: 2                   # m/s
  
  # === Yaw Control ===
  MAX_YAW_RATE: 10                         # deg/s
  
  # === Camera Aiming ===
  DESIRE_AIM: [0, 0]                       # Desired aim point in frame
  IS_CAMERA_GIMBALED: false                # Fixed vs gimbal camera
  
  # === Control Scaling ===
  BASE_ADJUSTMENT_FACTOR_X: 0.1
  BASE_ADJUSTMENT_FACTOR_Y: 0.1
  ALTITUDE_FACTOR: 0.005                   # Scale with altitude

# ==============================================================================
# GAIN SCHEDULING
# ==============================================================================
GainScheduling:
  # üìà Altitude-based gain adjustment
  ENABLE_GAIN_SCHEDULING: false
  GAIN_SCHEDULING_PARAMETER: current_altitude
  
  # Altitude ranges and corresponding gains
  ALTITUDE_GAIN_SCHEDULE:
    '(0, 20)':      # 0-20m altitude
      x: {p: 5.5, i: 0.2, d: 0.4}
      y: {p: 5.5, i: 0.2, d: 0.4}
      z: {p: 1, i: 0.01, d: 0.1}
    '(20, 50)':     # 20-50m altitude
      x: {p: 6, i: 0.25, d: 0.5}
      y: {p: 6, i: 0.25, d: 0.5}
      z: {p: 1, i: 0.015, d: 0.15}
    '(50, 100)':    # 50-100m altitude
      x: {p: 6.5, i: 0.3, d: 0.6}
      y: {p: 6.5, i: 0.3, d: 0.6}
      z: {p: 1, i: 0.02, d: 0.2}
    '(100, 150)':   # 100-150m altitude
      x: {p: 6, i: 0.3, d: 1.0}
      y: {p: 6, i: 0.3, d: 1.0}
      z: {p: 1, i: 0.01, d: 0.01}
    '(150, 200)':   # 150-200m altitude
      x: {p: 5.5, i: 0.25, d: 0.8}
      y: {p: 5.5, i: 0.25, d: 0.8}
      z: {p: 1, i: 0.01, d: 0.05}

# ==============================================================================
# SETPOINT CONTROL
# ==============================================================================
Setpoint:
  # üìç Position/velocity setpoint configuration
  CAMERA_YAW_OFFSET: 0                     # Camera mounting offset (degrees)
  SETPOINT_PUBLISH_RATE_S: 0.1             # Setpoint update period (seconds)
  ENABLE_SETPOINT_DEBUGGING: false         # Debug output

# ==============================================================================
# TELEMETRY
# ==============================================================================
Telemetry:
  # üìä Telemetry data distribution
  ENABLE_TELEMETRY: true
  TELEMETRY_SEND_RATE: 2                   # Hz
  TELEMETRY_FLASK_ENDPOINT: /telemetry     # REST endpoint
  
  # === UDP Telemetry ===
  ENABLE_UDP_STREAM: false
  UDP_HOST: 127.0.0.1
  UDP_PORT: 5550
  
  # === WebSocket Telemetry ===
  WEBSOCK_HOST: 127.0.0.1
  WEBSOCK_PORT: 5551
  
  # === Data Selection ===
  ENABLE_FOLLOWER_TELEMETRY: true          # Include follower status

# ==============================================================================
# GSTREAMER OUTPUT STREAM (Secondary Output)
# ==============================================================================
GStreamer:
  # üìπ Optional GStreamer pipeline for external streaming
  ENABLE_GSTREAMER_STREAM: false
  GSTREAMER_HOST: 127.0.0.1
  GSTREAMER_PORT: 2000
  GSTREAMER_BITRATE: 2000                  # kbps
  GSTREAMER_WIDTH: 1280
  GSTREAMER_HEIGHT: 720
  GSTREAMER_FRAMERATE: 15
  GSTREAMER_BUFFER_SIZE: 50000000          # bytes
  GSTREAMER_SPEED_PRESET: ultrafast        # x264 preset
  GSTREAMER_KEY_INT_MAX: 30                # Keyframe interval
  GSTREAMER_TUNE: zerolatency               # x264 tuning
  
  # === Video Enhancement ===
  GSTREAMER_CONTRAST: 5.0
  GSTREAMER_BRIGHTNESS: 10
  GSTREAMER_SATURATION: 5

# ==============================================================================
# OSD (ON-SCREEN DISPLAY)
# ==============================================================================
OSD:
  # üì∫ Video overlay configuration
  OSD_ENABLED: true
  
  OSD_CONFIG:
    # === Title/Watermark ===
    name:
      enabled: true
      text: PixEagle
      position: [3, 5]                     # % from top-left
      color: [255, 255, 255]               # BGR: White
      font_size: 0.7
    
    # === Timestamp ===
    datetime:
      enabled: true
      position: [98, 5]                    # % from top-left
      color: [255, 255, 255]
      font_size: 0.6
      alignment: right
    
    # === Crosshair ===
    crosshair:
      enabled: true
      color: [0, 255, 0]                   # BGR: Green
      thickness: 2
      length: 15
    
    # === Attitude Indicator (Artificial Horizon) ===
    attitude_indicator:
      enabled: true
      position: [50, 50]                   # Center position
      size: [70, 70]                       # Width, height
      horizon_color: [255, 255, 255]
      grid_color: [200, 200, 200]
      thickness: 2
    
    # === MAVLink Telemetry Data ===
    mavlink_data:
      enabled: true
      fields:
        # Navigation data
        heading:
          position: [45, 30]
          font_size: 0.5
          color: [255, 255, 255]
        airspeed:
          position: [10, 45]
          font_size: 0.4
          color: [255, 255, 255]
        groundspeed:
          position: [10, 55]
          font_size: 0.4
          color: [255, 255, 255]
        throttle:
          position: [10, 65]
          font_size: 0.3
          color: [255, 255, 255]
        
        # Altitude data
        altitude_msl:
          position: [65, 45]
          font_size: 0.4
          color: [255, 255, 255]
        altitude_agl:
          position: [65, 55]
          font_size: 0.4
          color: [255, 255, 255]
        flight_path_angle:
          position: [65, 65]
          font_size: 0.4
          color: [255, 255, 255]
        
        # Attitude
        roll:
          position: [45, 75]
          font_size: 0.5
          color: [255, 255, 255]
        pitch:
          position: [45, 80]
          font_size: 0.5
          color: [255, 255, 255]
        
        # GPS data
        latitude:
          position: [2, 92]
          font_size: 0.3
          color: [255, 255, 255]
        longitude:
          position: [2, 96]
          font_size: 0.3
          color: [255, 255, 255]
        satellites_visible:
          position: [2, 88]
          font_size: 0.4
          color: [255, 255, 255]
        hdop:
          position: [2, 84]
          font_size: 0.4
          color: [255, 255, 255]
        
        # System status
        voltage:
          position: [2, 12]
          font_size: 0.4
          color: [255, 255, 255]
        arm_status:
          position: [2, 16]
          font_size: 0.5
          color: [255, 255, 255]
        flight_mode:
          position: [45, 10]
          font_size: 0.5
          color: [0, 0, 255]               # BGR: Blue
          alignment: center
    
    # === Tracker Status ===
    tracker_status:
      enabled: true
      position: [75, 92]
      font_size: 0.4
      color: [255, 255, 0]                 # BGR: Cyan
    
    # === Follower Status ===
    follower_status:
      enabled: true
      position: [75, 96]
      font_size: 0.4
      color: [255, 255, 0]                 # BGR: Cyan

# ==============================================================================
# DEBUGGING & LOGGING
# ==============================================================================
Debugging:
  # üêõ Debug and logging configuration
  ENABLE_DEBUGGING: true
  LOG_FILE_PATH: logs/tracking_log.txt
  LOG_LEVEL: INFO                          # DEBUG, INFO, WARNING, ERROR
  SAVE_DEBUG_FRAMES: false                 # Save frames for analysis
  DEBUG_FRAME_PATH: debug_frames/          # Debug frame storage

# ==============================================================================
# DEPRECATED PARAMETERS
# ==============================================================================
# ‚ö†Ô∏è These parameters are kept for backward compatibility but should not be used
# in new deployments. They will be removed in future versions.
#
# CSI_WIDTH/HEIGHT/FRAMERATE ‚Üí Use CAPTURE_WIDTH/HEIGHT/FPS in VideoSource
# ESTIMATOR_ENABLED ‚Üí Use USE_ESTIMATOR in Estimator section
# DEFAULT_FPS in FrameEstimation ‚Üí Use DEFAULT_FPS in VideoSource
# ==============================================================================